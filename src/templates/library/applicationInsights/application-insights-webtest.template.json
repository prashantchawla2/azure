{
    "$schema": "http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "name": {
        "type": "string",
        "metadata": {
            "description": "The name of the application insights availability test."
        }
        },
        "applicationInsightsComponentName": {
            "type": "string",
        "metadata": {
            "description": "The name of the application insights component."
        }
        },
        "location": {
            "type": "string",
            "defaultValue": "[resourceGroup().location]"
        },
        "resourceURL": { "type": "string" }
    },
    "resources": [
        {
        "name": "[parameters('name')]",
        "type": "Microsoft.Insights/webtests",
        "apiVersion": "2014-04-01",
        "location": "[parameters('location')]",
        "tags": {
            "[concat('hidden-link:', resourceId('Microsoft.Insights/components', parameters('applicationInsightsComponentName')))]": "Resource"
        },
        "properties": {
            "Name": "[parameters('name')]",
            "Description": "Basic ping test",
            "Enabled": true,
            "Frequency": 900, // 15 minutes
            "Timeout": 120, // 2 minutes
            "Kind": "ping", // single URL test
            "RetryEnabled": true,
            "Locations": [
            {
                "Id": "emea-nl-ams-azr"
            },
            {
                "Id": "us-ca-sjc-azr"
            },
            {
                "Id": "apac-hk-hkn-azr"
            }
            ],
            "Configuration": {
            "WebTest": "[concat('<WebTest   Name=\"', parameters('name'), '\"   Enabled=\"True\"         CssProjectStructure=\"\"    CssIteration=\"\"  Timeout=\"120\"  WorkItemIds=\"\"         xmlns=\"http://microsoft.com/schemas/VisualStudio/TeamTest/2010\"         Description=\"\"  CredentialUserName=\"\"  CredentialPassword=\"\"         PreAuthenticate=\"True\"  Proxy=\"default\"  StopOnError=\"False\"         RecordedResultFile=\"\"  ResultsLocale=\"\">  <Items>  <Request Method=\"GET\"    Version=\"1.1\"  Url=\"', parameters('resourceURL'),   '\" ThinkTime=\"0\"  Timeout=\"300\" ParseDependentRequests=\"True\"         FollowRedirects=\"True\" RecordResult=\"True\" Cache=\"False\"         ResponseTimeGoal=\"0\"  Encoding=\"utf-8\"  ExpectedHttpStatusCode=\"200\"         ExpectedResponseUrl=\"\" ReportingName=\"\" IgnoreHttpStatusCode=\"False\" />        </Items> </WebTest>')]"
            },
            "SyntheticMonitorId": "[parameters('name')]"
        }
        }
    ],
    "outputs": {
    }
}
  